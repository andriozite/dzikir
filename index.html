<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dzikir & Doa Harian</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Amiri for Arabic, Inter for UI -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        arabic: ['Amiri', 'serif'],
                    },
                    colors: {
                        morning: {
                            bg: '#FDFBF7',
                            card: '#FFFFFF',
                            accent: '#F59E0B', // Amber
                            text: '#1F2937'
                        },
                        evening: {
                            bg: '#1E293B', // Slate 800
                            card: '#334155', // Slate 700
                            accent: '#818CF8', // Indigo
                            text: '#F1F5F9'
                        }
                    }
                }
            }
        }
    </script>

    <style>
        .arabic-text {
            direction: rtl;
            line-height: 2.2;
        }
        /* Smooth transition for theme switching */
        body, .card-bg, .btn-theme, header, nav {
            transition: background-color 0.5s ease, color 0.5s ease, border-color 0.5s ease;
        }
        /* Hide scrollbar for clean UI */
        ::-webkit-scrollbar {
            width: 0px;
            background: transparent;
        }
    </style>
</head>
<body id="body" class="bg-morning-bg text-morning-text min-h-screen flex flex-col pb-24">

    <!-- Header -->
    <header class="sticky top-0 z-50 backdrop-blur-md bg-opacity-90 border-b border-gray-200 dark:border-gray-700 shadow-sm transition-colors duration-500" id="header">
        <div class="max-w-3xl mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <!-- Reset All Button -->
                <button onclick="confirmResetAll()" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors text-gray-500 dark:text-gray-400" title="Reset Semua">
                    <i data-lucide="rotate-ccw" class="w-5 h-5"></i>
                </button>
                <div>
                    <h1 id="pageTitle" class="text-xl font-bold tracking-tight">Dzikir Pagi</h1>
                    <p class="text-xs opacity-80">Sesuai Tuntunan Sunnah</p>
                </div>
            </div>
            
            <!-- Toggle Switch (Only visible on Pagi/Petang tab) -->
            <button onclick="toggleMode()" id="themeBtn" class="flex items-center gap-2 px-4 py-2 rounded-full font-medium text-sm transition-all shadow-sm ring-1 ring-inset">
                <span id="modeIcon"></span>
                <span id="modeText">Pagi</span>
            </button>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="fixed top-[73px] left-0 h-1 bg-gray-200 w-full z-40">
        <div id="progressBar" class="h-full bg-green-500 transition-all duration-300 w-0"></div>
    </div>

    <!-- Main Content -->
    <main class="flex-grow max-w-2xl mx-auto px-4 py-6 w-full space-y-6" id="content-container">
        <!-- Content will be injected here via JS -->
    </main>

    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 left-0 w-full bg-white dark:bg-slate-900 border-t border-gray-200 dark:border-slate-800 z-50 pb-safe">
        <div class="max-w-md mx-auto flex justify-around items-center">
            <button onclick="switchTab('pagi_petang')" id="nav-pagi_petang" class="flex-1 py-4 flex flex-col items-center gap-1 text-amber-600 dark:text-indigo-400 transition-colors">
                <i data-lucide="sun-moon" class="w-6 h-6"></i>
                <span class="text-xs font-medium">Pagi & Petang</span>
            </button>
            <button onclick="switchTab('sholat')" id="nav-sholat" class="flex-1 py-4 flex flex-col items-center gap-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors">
                <!-- REVISED Custom SVG Icon for Ruku' (Side Profile) -->
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6">
                    <!-- Head -->
                    <circle cx="20" cy="9" r="2" />
                    <!-- Back and Legs (L shape rotated) -->
                    <path d="M7 21v-10h11" />
                    <!-- Arm reaching to knee -->
                    <path d="M17 11L8 16" />
                </svg>
                <span class="text-xs font-medium">Doa Sholat</span>
            </button>
        </div>
    </nav>

    <!-- Completion Modal -->
    <div id="completionModal" class="fixed inset-0 bg-black/50 z-[60] hidden flex items-center justify-center px-4 backdrop-blur-sm">
        <div class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-xl max-w-sm w-full text-center transform scale-95 transition-transform">
            <div class="mx-auto bg-green-100 text-green-600 rounded-full p-3 w-16 h-16 flex items-center justify-center mb-4">
                <i data-lucide="check" class="w-8 h-8"></i>
            </div>
            <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-2">Alhamdulillah!</h3>
            <p class="text-gray-600 dark:text-gray-300 mb-6 text-sm">Anda telah menyelesaikan rangkaian dzikir ini.</p>
            <button onclick="closeModal()" class="w-full bg-green-600 hover:bg-green-700 text-white font-medium py-2.5 rounded-lg transition-colors">
                Tutup
            </button>
        </div>
    </div>

    <!-- Credit Modal -->
    <div id="creditModal" onclick="closeCreditModal(event)" class="fixed inset-0 bg-black/60 z-[70] hidden flex items-center justify-center px-4 backdrop-blur-sm opacity-0 transition-opacity duration-300">
        <div class="bg-white dark:bg-slate-800 p-8 rounded-2xl shadow-2xl max-w-sm w-full text-center transform scale-90 transition-transform duration-300 relative border-t-4 border-amber-500">
            <button onclick="closeCreditModal(null)" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200">
                <i data-lucide="x" class="w-5 h-5"></i>
            </button>
            <div class="mb-4">
                <span class="inline-block p-3 rounded-full bg-amber-100 dark:bg-amber-900/30 text-amber-600 dark:text-amber-500">
                    <i data-lucide="heart-handshake" class="w-8 h-8"></i>
                </span>
            </div>
            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Dibuat Oleh</h3>
            <p class="text-gray-800 dark:text-gray-200 font-semibold text-lg leading-relaxed mb-2">
                Andrian
            </p>
            <p class="text-gray-600 dark:text-gray-400 italic font-serif text-sm leading-relaxed">
                "Hamba Allah yang penuh dosa"
            </p>
            <div class="mt-6 pt-4 border-t border-gray-100 dark:border-slate-700">
                <p class="text-xs text-gray-500 dark:text-gray-400 leading-relaxed">
                    Semoga Allah mengampuni dosa saya dan keluarga, serta memberikan rezeki yang berlimpah. Aamiin.
                </p>
            </div>
        </div>
    </div>

    <!-- Footer Content (moved inside main or hidden, here accessible via footer link in menu if needed, but keeping simple for now) -->
    <div class="hidden">
        <!-- Reusing modal logic for footer credits -->
    </div>

    <script>
        // --- Data Dzikir Pagi & Petang ---
        const dzikirCommon = [
            {
                id: "c1",
                title: "Membaca Ta'awudz",
                arabic: "أَعُوذُ بِاللَّهِ مِنَ الشَّيْطَانِ الرَّجِيمِ",
                latin: "A'udzu billahi minasy-syaithonir-rojim",
                translation: "Aku berlindung kepada Allah dari godaan syaitan yang terkutuk.",
                count: 1,
                ref: "QS. Al-A'raf: 200",
                note: "Dibaca sebelum memulai dzikir."
            },
            {
                id: "c2",
                title: "Ayat Kursi",
                arabic: "اللَّهُ لَا إِلَهَ إِلَّا هُوَ الْحَيُّ الْقَيُّومُ لَا تَأْخُذُهُ سِنَةٌ وَلَا نَوْمٌ لَهُ مَا فِي السَّمَاوَاتِ وَمَا فِي الْأَرْضِ مَنْ ذَا الَّذِي يَشْفَعُ عِنْدَهُ إِلَّا بِإِذْنِهِ يَعْلَمُ مَا بَيْنَ أَيْدِيهِمْ وَمَا خَلْفَهُمْ وَلَا يُحِيطُونَ بِشَيْءٍ مِنْ عِلْمِهِ إِلَّا بِمَا شَاءَ وَسِعَ كُرْسِيُّهُ السَّمَاوَاتِ وَالْأَرْضَ وَلَا يَئُودُهُ حِفْظُهُمَا وَهُوَ الْعَلِيُّ الْعَظِيمُ",
                latin: "Allahu laa ilaaha illaa huwal hayyul qoyyuum...",
                translation: "Allah, tidak ada Tuhan yang berhak disembah melainkan Dia Yang Hidup kekal lagi terus menerus mengurus makhluk-Nya...",
                count: 1,
                ref: "HR. An-Nasa-i",
                note: "Dibaca pagi & petang."
            },
            {
                id: "c3",
                title: "Surah Al-Ikhlas",
                arabic: "قُلْ هُوَ ٱللَّهُ أَحَدٌ ۞ ٱللَّهُ ٱلصَّمَدُ ۞ لَمْ يَلِدْ وَلَمْ يُولَدْ ۞ وَلَمْ يَكُن لَّهُۥ كُفُوًا أَحَدٌۢ",
                latin: "Qul huwallahu ahad...",
                translation: "Katakanlah: Dialah Allah, Yang Maha Esa...",
                count: 3,
                ref: "HR. Abu Daud",
                note: "Dibaca 3x."
            },
            {
                id: "c4",
                title: "Surah Al-Falaq",
                arabic: "قُلْ أَعُوذُ بِرَبِّ ٱلْفَلَقِ ۞ مِن شَرِّ مَا خَلَقَ ۞ وَمِن شَرِّ غَاسِقٍ إِذَا وَقَبَ ۞ وَمِن شَرِّ ٱلنَّفَّٰثَٰتِ فِى ٱلْعُقَدِ ۞ وَمِن شَرِّ حَاسِدٍ إِذَا حَسَدَ",
                latin: "Qul a'udzu bi rabbil-falaq...",
                translation: "Katakanlah: Aku berlindung kepada Tuhan yang menguasai subuh...",
                count: 3,
                ref: "HR. Abu Daud",
                note: "Dibaca 3x."
            },
            {
                id: "c5",
                title: "Surah An-Nas",
                arabic: "قُلْ أَعُوذُ بِرَبِّ ٱلنَّاسِ ۞ مَلِكِ ٱلنَّاسِ ۞ إِلَٰهِ ٱلنَّاسِ ۞ مِن شَرِّ ٱلْوَسْوَاسِ ٱلْخَنَّاسِ ۞ ٱلَّذِى يُوَسْوِسُ فِى صُدُورِ ٱلنَّاسِ ۞ مِنَ ٱلْجِنَّةِ وَٱلنَّاسِ",
                latin: "Qul a'udzu bi rabbin-naas...",
                translation: "Katakanlah: Aku berlindung kepada Tuhan (yang memelihara dan menguasai) manusia...",
                count: 3,
                ref: "HR. Abu Daud",
                note: "Dibaca 3x."
            },
            {
                id: "c6",
                title: "Sayyidul Istighfar",
                arabic: "اللَّهُمَّ أَنْتَ رَبِّي لَا إِلَهَ إِلَّا أَنْتَ خَلَقْتَنِي وَأَنَا عَبْدُكَ وَأَنَا عَلَى عَهْدِكَ وَوَعْدِكَ مَا اسْتَطَعْتُ أَعُوذُ بِكَ مِنْ شَرِّ مَا صَنَعْتُ أَبُوءُ لَكَ بِنِعْمَتِكَ عَلَيَّ وَأَبُوءُ لَكَ بِذَنْبِي فَاغْفِرْ لِي فَإِنَّهُ لَا يَغْفِرُ الذُّنُوبَ إِلَّا أَنْتَ",
                latin: "Allahumma anta rabbii laa ilaaha illaa anta khalaqtanii...",
                translation: "Ya Allah, Engkau adalah Rabbku, tidak ada Tuhan yang berhak disembah kecuali Engkau...",
                count: 1,
                ref: "HR. Bukhari",
                note: "Penghulu istighfar."
            }
        ];

        const dzikirMorningSpecific = [
            {
                id: "m1",
                title: "Doa Pagi Hari",
                arabic: "اللَّهُمَّ بِكَ أَصْبَحْنَا، وَبِكَ أَمْسَيْنَا، وَبِكَ نَحْيَا، وَبِكَ نَمُوتُ، وَإِلَيْكَ النُّشُورُ",
                latin: "Allahumma bika ashbahna, wa bika amsayna...",
                translation: "Ya Allah, dengan rahmat-Mu kami memasuki waktu pagi...",
                count: 1,
                ref: "HR. Tirmidzi",
                note: ""
            },
            {
                id: "m2",
                title: "Tasbih & Tahmid",
                arabic: "سُبْحَانَ اللهِ وَبِحَمْدِهِ",
                latin: "Subhanallah wa bi-hamdih.",
                translation: "Maha Suci Allah dengan segala puji bagi-Nya.",
                count: 100,
                ref: "HR. Muslim",
                note: "Dibaca 100x."
            }
        ];

        const dzikirEveningSpecific = [
            {
                id: "e1",
                title: "Doa Petang Hari",
                arabic: "اللَّهُمَّ بِكَ أَمْسَيْنَا، وَبِكَ أَصْبَحْنَا، وَبِكَ نَحْيَا، وَبِكَ نَمُوتُ، وَإِلَيْكَ الْمَصِيرُ",
                latin: "Allahumma bika amsayna, wa bika ashbahna...",
                translation: "Ya Allah, dengan rahmat-Mu kami memasuki waktu sore...",
                count: 1,
                ref: "HR. Tirmidzi",
                note: ""
            },
            {
                id: "e2",
                title: "Perlindungan Malam",
                arabic: "أَعُوذُ بِكَلِمَاتِ اللهِ التَّامَّاتِ مِنْ شَرِّ مَا خَلَقَ",
                latin: "A'udzu bi-kalimaatillahit-taammaati min syarri maa kholaq.",
                translation: "Aku berlindung dengan kalimat-kalimat Allah yang sempurna...",
                count: 3,
                ref: "HR. Muslim",
                note: "Dibaca 3x."
            }
        ];

        const dzikirClosing = [
            {
                id: "close1",
                title: "Doa Penutup Majelis",
                arabic: "سُبْحَانَكَ اللَّهُمَّ وَبِحَمْدِكَ، أَشْهَدُ أَنْ لَا إِلَهَ إِلَّا أَنْتَ، أَسْتَغْفِرُكَ وَأَتُوبُ إِلَيْكَ",
                latin: "Subhanakallahumma wa bihamdika...",
                translation: "Maha Suci Engkau Ya Allah dan segala puji bagi-Mu...",
                count: 1,
                ref: "HR. Tirmidzi",
                note: "Penutup dzikir."
            }
        ];

        // --- Data Doa Sholat Fardhu ---
        const doaSholatData = [
            {
                id: "s1",
                title: "Istighfar",
                arabic: "أَسْتَغْفِرُ اللَّهَ، أَسْتَغْفِرُ اللَّهَ، أَسْتَغْفِرُ اللَّهَ",
                latin: "Astaghfirullah (3x)",
                translation: "Aku memohon ampun kepada Allah.",
                count: 3,
                ref: "HR. Muslim",
                note: "Membaca istighfar 3 kali segera setelah salam."
            },
            {
                id: "s2",
                title: "Doa Keselamatan",
                arabic: "اللَّهُمَّ أَنْتَ السَّلاَمُ، وَمِنْكَ السَّلاَمُ، تَبَارَكْتَ يَا ذَا الْجَلاَلِ وَالإِكْرَامِ",
                latin: "Allahumma antas salaam wa minkas salaam, tabaarakta yaa dzal jalaali wal ikraam.",
                translation: "Ya Allah, Engkau Mahasejahtera, dan dari-Mu kesejahteraan...",
                count: 1,
                ref: "HR. Muslim",
                note: ""
            },
            {
                id: "s3",
                title: "Tahlil",
                arabic: "لَا إِلَهَ إِلَّا اللهُ وَحْدَهُ لَا شَرِيكَ لَهُ، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ وَهُوَ عَلَى كُلِّ شَيْءٍ قَدِيرٌ",
                latin: "Laa ilaaha illallahu wahdahu laa syariikalah...",
                translation: "Tiada Tuhan yang berhak disembah selain Allah semata...",
                count: 1,
                ref: "Muttafaq 'alaih",
                note: ""
            },
            {
                id: "s4",
                title: "Ayat Kursi",
                arabic: "اللَّهُ لَا إِلَهَ إِلَّا هُوَ الْحَيُّ الْقَيُّومُ...",
                latin: "Allahu laa ilaaha illaa huwal hayyul qoyyuum...",
                translation: "Allah, tidak ada Tuhan yang berhak disembah melainkan Dia...",
                count: 1,
                ref: "HR. An-Nasa-i",
                note: "Barangsiapa membacanya setiap usai sholat fardhu, tidak ada yang menghalanginya masuk surga selain kematian."
            },
            {
                id: "s5",
                title: "Tasbih (Subhanallah)",
                arabic: "سُبْحَانَ اللهِ",
                latin: "Subhanallah",
                translation: "Maha Suci Allah.",
                count: 33,
                ref: "HR. Muslim",
                note: "Dibaca 33 kali."
            },
            {
                id: "s6",
                title: "Tahmid (Alhamdulillah)",
                arabic: "الْحَمْدُ لِلَّهِ",
                latin: "Alhamdulillah",
                translation: "Segala puji bagi Allah.",
                count: 33,
                ref: "HR. Muslim",
                note: "Dibaca 33 kali."
            },
            {
                id: "s7",
                title: "Takbir (Allahu Akbar)",
                arabic: "اللَّهُ أَكْبَرُ",
                latin: "Allahu Akbar",
                translation: "Allah Maha Besar.",
                count: 33,
                ref: "HR. Muslim",
                note: "Dibaca 33 kali."
            },
            {
                id: "s8",
                title: "Penyempurna 100",
                arabic: "لَا إِلَهَ إِلَّا اللهُ وَحْدَهُ لَا شَرِيكَ لَهُ، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ وَهُوَ عَلَى كُلِّ شَيْءٍ قَدِيرٌ",
                latin: "Laa ilaaha illallahu wahdahu laa syariikalah...",
                translation: "Tiada Tuhan yang berhak disembah selain Allah semata...",
                count: 1,
                ref: "HR. Muslim",
                note: "Penyempurna hitungan menjadi 100."
            }
        ];

        // --- State Management ---
        let currentMode = 'pagi'; // 'pagi' or 'petang'
        let currentTab = 'pagi_petang'; // 'pagi_petang' or 'sholat'
        let displayData = [];
        let progress = {};

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            
            // Initial Time Check
            const hour = new Date().getHours();
            currentMode = (hour >= 15 || hour < 4) ? 'petang' : 'pagi';
            
            updateTheme();
            switchTab('pagi_petang'); // Load default tab
        });

        // --- Core Functions ---

        function switchTab(tabId) {
            currentTab = tabId;
            
            // Update Nav Styles
            const navPP = document.getElementById('nav-pagi_petang');
            const navSholat = document.getElementById('nav-sholat');
            
            // Color classes
            const activeClass = (currentMode === 'pagi') ? 'text-amber-600' : 'text-indigo-400';
            const inactiveClass = 'text-gray-400 hover:text-gray-600 dark:hover:text-gray-300';
            
            if (tabId === 'pagi_petang') {
                navPP.className = `flex-1 py-4 flex flex-col items-center gap-1 transition-colors ${activeClass}`;
                navSholat.className = `flex-1 py-4 flex flex-col items-center gap-1 transition-colors ${inactiveClass}`;
                document.getElementById('themeBtn').style.display = 'flex'; // Show toggle
                document.getElementById('pageTitle').innerText = (currentMode === 'pagi') ? 'Dzikir Pagi' : 'Dzikir Petang';
            } else {
                navSholat.className = `flex-1 py-4 flex flex-col items-center gap-1 transition-colors ${activeClass}`;
                navPP.className = `flex-1 py-4 flex flex-col items-center gap-1 transition-colors ${inactiveClass}`;
                document.getElementById('themeBtn').style.display = 'none'; // Hide toggle
                document.getElementById('pageTitle').innerText = 'Doa Sholat Fardhu';
            }

            loadDzikir();
        }

        function toggleMode() {
            if (currentTab !== 'pagi_petang') return;
            currentMode = currentMode === 'pagi' ? 'petang' : 'pagi';
            updateTheme();
            loadDzikir();
        }

        function updateTheme() {
            const body = document.getElementById('body');
            const header = document.getElementById('header');
            const nav = document.querySelector('nav');
            const btn = document.getElementById('themeBtn');
            const iconSpan = document.getElementById('modeIcon');
            const textSpan = document.getElementById('modeText');
            const pageTitle = document.getElementById('pageTitle');

            if (currentMode === 'pagi') {
                body.className = "bg-morning-bg text-morning-text min-h-screen flex flex-col pb-24 transition-colors duration-500";
                header.className = "sticky top-0 z-50 backdrop-blur-md bg-white/80 border-b border-gray-200 shadow-sm transition-colors duration-500";
                nav.className = "fixed bottom-0 left-0 w-full bg-white border-t border-gray-200 z-50 pb-safe transition-colors duration-500";
                btn.className = "flex items-center gap-2 px-4 py-2 rounded-full font-medium text-sm transition-all shadow-sm ring-1 ring-inset ring-morning-accent text-amber-700 bg-amber-50 hover:bg-amber-100";
                
                iconSpan.innerHTML = '<i data-lucide="sun" class="w-4 h-4"></i>';
                textSpan.innerText = "Pagi";
                
                if(currentTab === 'pagi_petang') pageTitle.innerText = "Dzikir Pagi";
            } else {
                body.className = "bg-evening-bg text-evening-text min-h-screen flex flex-col pb-24 transition-colors duration-500";
                header.className = "sticky top-0 z-50 backdrop-blur-md bg-slate-900/80 border-b border-slate-700 shadow-sm transition-colors duration-500";
                nav.className = "fixed bottom-0 left-0 w-full bg-slate-900 border-t border-slate-800 z-50 pb-safe transition-colors duration-500";
                btn.className = "flex items-center gap-2 px-4 py-2 rounded-full font-medium text-sm transition-all shadow-sm ring-1 ring-inset ring-evening-accent text-indigo-300 bg-slate-800 hover:bg-slate-700";
                
                iconSpan.innerHTML = '<i data-lucide="moon" class="w-4 h-4"></i>';
                textSpan.innerText = "Petang";
                
                if(currentTab === 'pagi_petang') pageTitle.innerText = "Dzikir Petang";
            }
            
            // Re-apply active tab color if needed
            switchTab(currentTab);
        }

        function loadDzikir() {
            if (currentTab === 'pagi_petang') {
                const specific = currentMode === 'pagi' ? dzikirMorningSpecific : dzikirEveningSpecific;
                displayData = [...dzikirCommon, ...specific, ...dzikirClosing];
            } else {
                displayData = [...doaSholatData];
            }
            
            // Initialize progress
            displayData.forEach(item => {
                if (progress[item.id] === undefined) {
                    progress[item.id] = item.count; 
                }
            });

            renderList();
            updateProgressBar();
        }

        function renderList() {
            const container = document.getElementById('content-container');
            container.innerHTML = '';

            // Add Footer/Credit link at the bottom of the list for easy access
            const footerHtml = `
                <div class="pt-8 pb-4 text-center opacity-60">
                    <button onclick="openCreditModal()" class="text-xs font-medium hover:underline flex items-center justify-center gap-1 mx-auto transition-opacity">
                        <span>Tentang Pembuat</span>
                    </button>
                </div>
            `;

            displayData.forEach((item, index) => {
                const isComplete = progress[item.id] === 0;
                const remaining = progress[item.id];
                const total = item.count;
                
                let cardClass = "";
                let btnClass = "";
                let resetBtnClass = "";
                
                // Theme Logic
                if (currentMode === 'pagi') {
                    cardClass = isComplete ? "bg-gray-100 border-gray-200 opacity-60" : "bg-white border-gray-200 shadow-sm";
                    btnClass = isComplete 
                        ? "bg-gray-300 text-gray-500 cursor-default" 
                        : "bg-amber-100 text-amber-700 hover:bg-amber-200 active:scale-95";
                    resetBtnClass = "border-gray-200 text-gray-400 hover:text-amber-600 hover:bg-gray-50";
                } else {
                    cardClass = isComplete ? "bg-slate-800 border-slate-700 opacity-60" : "bg-slate-700 border-slate-600 shadow-md";
                    btnClass = isComplete 
                        ? "bg-slate-800 text-slate-500 cursor-default" 
                        : "bg-indigo-900/50 text-indigo-300 hover:bg-indigo-900/80 active:scale-95 border border-indigo-500/30";
                    resetBtnClass = "border-slate-600 text-slate-400 hover:text-indigo-400 hover:bg-slate-600";
                }

                const html = `
                    <div class="rounded-2xl border p-5 sm:p-6 relative overflow-hidden transition-all duration-300 ${cardClass}">
                        ${isComplete ? `<div class="absolute top-4 right-4 text-green-500"><i data-lucide="check-circle-2" class="w-6 h-6"></i></div>` : ''}
                        
                        <div class="mb-4">
                            <h2 class="text-sm font-semibold uppercase tracking-wide opacity-70 mb-1 flex items-center gap-2">
                                <span class="w-6 h-6 rounded-full bg-gray-200 dark:bg-slate-600 flex items-center justify-center text-xs font-bold">${index + 1}</span>
                                ${item.title}
                            </h2>
                        </div>

                        <div class="mb-6 text-right">
                            <p class="arabic-text font-arabic text-3xl sm:text-4xl leading-loose mb-4" lang="ar">${item.arabic}</p>
                        </div>

                        <div class="space-y-3 mb-6">
                            <p class="text-sm italic opacity-80 leading-relaxed font-serif text-gray-500 dark:text-gray-400">${item.latin}</p>
                            <p class="text-sm leading-relaxed">${item.translation}</p>
                        </div>

                        <div class="flex flex-col sm:flex-row items-center justify-between gap-4 pt-4 border-t border-gray-100 dark:border-slate-600">
                            <div class="text-xs opacity-60 flex items-center gap-1">
                                <i data-lucide="book-open" class="w-3 h-3"></i>
                                ${item.ref}
                            </div>
                            
                            <div class="w-full sm:w-auto flex gap-2">
                                <button onclick="resetCounter('${item.id}')" 
                                    class="p-3 rounded-xl border transition-colors ${resetBtnClass}"
                                    title="Ulangi">
                                    <i data-lucide="rotate-ccw" class="w-5 h-5"></i>
                                </button>

                                <button onclick="decrementCounter('${item.id}', ${total})" 
                                    class="flex-grow sm:w-48 py-3 rounded-xl font-bold text-lg flex items-center justify-center gap-3 transition-all select-none ${btnClass}"
                                    ${isComplete ? 'disabled' : ''}>
                                    ${isComplete 
                                        ? '<span>Selesai</span>' 
                                        : `<i data-lucide="fingerprint" class="w-5 h-5"></i>
                                           <span>${remaining} / ${total}x</span>`
                                    }
                                </button>
                            </div>
                        </div>
                        
                        ${item.note ? `
                        <div class="mt-4 bg-gray-50 dark:bg-slate-800/50 p-3 rounded-lg text-xs opacity-70 flex gap-2 items-start">
                            <i data-lucide="info" class="w-3 h-3 mt-0.5 flex-shrink-0"></i>
                            <span>${item.note}</span>
                        </div>
                        ` : ''}
                    </div>
                `;
                container.innerHTML += html;
            });
            
            container.innerHTML += footerHtml;
            lucide.createIcons();
        }

        function decrementCounter(id, total) {
            if (progress[id] > 0) {
                progress[id]--;
                renderList();
                updateProgressBar();
                if (navigator.vibrate) navigator.vibrate(50);
            }
        }

        function resetCounter(id) {
            const item = displayData.find(d => d.id === id);
            if (item) {
                progress[id] = item.count;
                renderList();
                updateProgressBar();
            }
        }

        function confirmResetAll() {
            if (confirm("Reset semua hitungan di halaman ini?")) {
                resetAll();
            }
        }

        function resetAll() {
            displayData.forEach(item => {
                progress[item.id] = item.count;
            });
            renderList();
            updateProgressBar();
            document.getElementById('completionModal').classList.add('hidden');
        }

        function updateProgressBar() {
            const totalCounts = displayData.reduce((acc, curr) => acc + curr.count, 0);
            const currentRemaining = displayData.reduce((acc, curr) => acc + progress[curr.id], 0);
            const completed = totalCounts - currentRemaining;
            
            const percentage = totalCounts === 0 ? 0 : (completed / totalCounts) * 100;
            document.getElementById('progressBar').style.width = percentage + '%';

            if (percentage === 100 && totalCounts > 0) {
                setTimeout(() => {
                    showCompletionModal();
                }, 500);
            }
        }

        // --- Modals Logic ---
        function showCompletionModal() {
            document.getElementById('completionModal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('completionModal').classList.add('hidden');
        }

        function openCreditModal() {
            const modal = document.getElementById('creditModal');
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                const content = modal.querySelector('div');
                content.classList.remove('scale-90');
                content.classList.add('scale-100');
            }, 10);
        }

        function closeCreditModal(e) {
            const modal = document.getElementById('creditModal');
            if (e === null || e.target === modal) {
                modal.classList.add('opacity-0');
                const content = modal.querySelector('div');
                content.classList.remove('scale-100');
                content.classList.add('scale-90');
                setTimeout(() => modal.classList.add('hidden'), 300);
            }
        }
    </script>
</body>
</html>
